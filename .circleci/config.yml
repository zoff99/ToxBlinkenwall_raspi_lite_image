---
version: 2

workflows:
  version: 2
  build_linux:
    jobs:
      - pigen

jobs:
  pigen:
    working_directory: ~/work
    machine:
      image: circleci/classic:latest
    # docker:
    #  - image: debian:jessie

    steps:
      - checkout
      - run: lsb_release --all
      - run: python --version
      - run: apt --version
      - run: sudo apt update &&
          sudo apt install -y --no-install-recommends apt apt-transport-https
      - run: apt --version
      - run: sudo apt update &&
          sudo apt install -y --no-install-recommends
            quilt parted realpath qemu-user-static debootstrap zerofree pxz zip
            dosfstools bsdtar libcap2-bin grep rsync xz-utils file git curl
            openssl ca-certificates git sudo bc wget rsync
            qemu-kvm libvirt-bin ubuntu-vm-builder bridge-utils
            python-libvirt

      - run: pwd; ls -al; id -a
      - run: git clone https://github.com/Linutronix/elbe.git
      - run: pwd; ls -al; id -a
      - run: cd elbe;./elbe initvm create --directory=initvm
      - run: cd elbe;./elbe initvm submit --directory=initvm examples/rescue.xml


